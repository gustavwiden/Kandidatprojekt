########## NAME
mPBPK_SLE_model_10_pdc_mm2

########## METADATA
time_unit = h

########## MACROS

########## STATES
d/dt(Plasma) = (r2+r3-r4-r5-r6-r10)/Vp-r13              // Change in concentration of total BIIB059 over time in plasma compartment (pM/h).
d/dt(Skin) = (r4-r7)/Vs-r16                             // Change in concentration of total BIIB059 over time in skin compartment (pM/h).
d/dt(Tight) = (r5-r8)/V1                                // Change in concentration of total BIIB059 over time in tight compartment (pM/h).
d/dt(Leaky) = (r6-r9)/V2                                // Change in concentration of total BIIB059 over time in leaky compartment (pM/h).
d/dt(Lymph) = (-r3+r7+r8+r9)/VL                         // Change in concentration of total BIIB059 over time in lymph compartment (pM/h).
d/dt(Depot) = -r1                                       // Change in amount of total BIIB059 over time in depot compartment (pM/h).
d/dt(BDCA2_plasma) = r11-r12-r13                        // Change in concentration of total BDCA2 over time in plasma compartment (pM/h).
d/dt(BDCA2_skin) = r14-r15-r16                          // Change in concentration of total BDCA2 over time in skin compartment (pM/h).

Plasma(0) = 0                                           // Initial concentration of total BIIB059 in plasma compartment (pM).
Skin(0) = 0                                             // Initial concentration of total BIIB059 in skin compartment (pM).
Tight(0) = 0                                            // Initial concentration of total BIIB059 in tight compartment (pM).
Leaky(0) = 0                                            // Initial concentration of total BIIB059 in leaky compartment (pM).
Lymph(0) = 0                                            // Initial concentration of total BIIB059 in lymph compartment (pM).
Depot(0) = 0                                            // Initial amount of total BIIB059 in depot compartment (pmol).
BDCA2_plasma(0) = 15.9                                  // Initial concentration of total BDCA2 in plasma compartment (pM).
BDCA2_skin(0) = 751                                    // Initial concentration of total BDCA2 in skin compartment (pM).

########## PARAMETERS
F = 0.598                                               // Bioavailibility.
ka = 0.0135                                             // Absorption rate (1/h).
Vp = 2.6                                                // Volume of plasma compartment (L).
Vs = 1.125                                              // Volume of interstitial fluid in skin compartment (L).
V1 = 6.987                                              // Volume of interstitial fluid in tight compartment (L).
V2 = 4.368                                              // Volume of interstitial fluid in leaky compartment (L).
VL = 2.6                                                // Volume of lymph compartment (L).
Ls = 0.0065                                             // Lymph flow rate for skin compartment (L/h).
L1 = 0.0338                                             // Lymph flow rate for tight compartment (L/h).
L2 = 0.081                                              // Lymph flow rate for leaky compartment (L/h).
RCS = 0.8                                              // Reflection co-efficient for skin compartment.
RC1 = 0.95                                              // Reflection co-efficient for tight compartment.
RC2 = 0.75                                              // Reflection co-efficient for leaky compartment.
RCL = 0.20                                              // Reflection co-efficient for lymph compartment.
CL = 0.00733                                            // Linear clearance of BIIB059 from plasma compartment (L/h).
kdegp = 0.962                                           // Degradation rate of BDCA2 in plasma compartment (1/h).
kdegs = 0.05                                             // Degradation rate of BDCA2 in skin compartment (1/h).
kintp = 5.54                                            // Internalization rate of BDCA2-BIIB059 complex in plasma compartment (1/h).
kints = 5.54                                            // Internalization rate of BDCA2-BIIB059 complex in skin compartment (1/h).
kss = 2624                                              // Steady state coefficient (pM).

########## VARIABLES
ksynp = kdegp*15.9                                                                                              // Synthesis rate of BDCA2 in plasma compartment (pM/h).
Plasma_free = 0.5*((Plasma - kss - BDCA2_plasma) + sqrt((Plasma - kss - BDCA2_plasma)^2 + 4*Plasma*kss))        // Concentration of free BIIB059 in plasma compartment (pM).
BDCA2_plasma_bound = (BDCA2_plasma * Plasma_free) / (kss + Plasma_free)                                         // Concentration of bound BDCA2 in plasma compartment (pM).

ksyns = kdegs*751                                                                                              // Synthesis rate of BDCA2 in skin compartment (pM/h).
Skin_free = 0.5*((Skin - kss - BDCA2_skin) + sqrt((Skin - kss - BDCA2_skin)^2 + 4*Skin*kss))                    // Concentration of free BIIB059 in skin compartment (pM).   
BDCA2_skin_bound = (BDCA2_skin * Skin_free) / (kss + Skin_free)                                                 // Concentration of bound BDCA2 in skin compartment (pM).

r1 = ka*Depot                                                      // Depletion of BIIB059 in depot compartment (pM/h).
r2 = F*ka*Depot                                                    // Absorption of BIIB059 in plasma compartment (pM/h).
r3 = (Ls+L1+L2)*Lymph                                              // Lymphatic return of BIIB059 to plasma compartment (pmol/h).
r4 = Ls*(1-RCS)*Plasma_free                                        // Distribution of BIIB059 to skin compartment (pmol/h).
r5 = L1*(1-RC1)*Plasma_free                                        // Distribution of BIIB059 to tight compartment (pmol/h).
r6 = L2*(1-RC2)*Plasma_free                                        // Distribution of BIIB059 to leaky compartment (pmol/h).
r7 = Ls*(1-RCL)*Skin_free                                          // Lymphatic uptake of BIIB059 from skin compartment (pmol/h).
r8 = L1*(1-RCL)*Tight                                              // Lymphatic uptake of BIIB059 from tight compartment (pmol/h).
r9 = L2*(1-RCL)*Leaky                                              // Lymphatic uptake of BIIB059 from leaky compartment (pmol/h).
r10 = CL*Plasma_free                                               // Linear clearance of BIIB059 from plasma compartment (pmol/h).
r11 = ksynp                                                        // Synthesis of free BDCA2 in plasma compartment (pM/h).
r12 = kdegp*(BDCA2_plasma-BDCA2_plasma_bound)                      // Degradation of free BDCA2 in plasma compartment (pM/h).
r13 = kintp*BDCA2_plasma_bound                                     // Internalization of BDCA2-BIIB059 complex in plasma compartment (pM/h).
r14 = ksyns                                                        // Synthesis of free BDCA2 in skin compartment (pM/h).
r15 = kdegs*(BDCA2_skin-BDCA2_skin_bound)                          // Degradation of free BDCA2 in skin compartment (pM/h).
r16 = kints*BDCA2_skin_bound                                       // Internalization of BDCA2-BIIB059 complex in skin compartment (pM/h).

########## FUNCTIONS

########## EVENTS
IV_dose = IV > 0, Plasma, Plasma + IV*1e6/(146600*Vp)              // Intravenous (IV) dose of BIIB059 in plasma compartment (pM).
SC_dose = SC > 0, Depot, Depot + SC*1e6/(146600)                   // Subcutaneous (SC) dose of BIIB059 in depot compartment (pmol).

########## OUTPUTS

########## INPUTS
IV = IV_in @ 0
SC = SC_in @ 0

########## FEATURES
PK_sim = (Plasma_free*146600)/1e9                                  // Simulation: Concentration of free BIIB059 in plasma compartment (μg/mL).
PD_sim = 100*(BDCA2_plasma-15.9)/15.9                              // Simulation: Expression of total BDCA2 on pDCs in plasma compartment (% change from baseline).
PK_sim_skin = (Skin_free*146600)/1e9                               // Simulation: Concentration of free BIIB059 in skin compartment (μg/mL).
PD_sim_skin = 100*(BDCA2_skin-BDCA2_skin_bound-751)/751          // Simulation: Expression of free BDCA2 on pDCs in skin compartment (% change from baseline).